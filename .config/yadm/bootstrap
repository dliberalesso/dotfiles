#!/usr/bin/env zsh
# vim:syntax=zsh
# vim:filetype=zsh

echo "Cloning zinit and vim-packager"
git clone https://github.com/zdharma/zinit.git "$HOME/.config/zsh/.zinit/bin"
git clone https://github.com/kristijanhusak/vim-packager "$HOME/.config/nvim/pack/packager/opt/vim-packager"

echo "Doing sparse checkout"
yadm gitconfig core.sparseCheckout true

cat << EOF > "$HOME/.config/yadm/repo.git/info/sparse-checkout"
# generated by $0
/*
!README.md
EOF

yadm checkout --quiet

echo "Creating nvim's undodir"
mkdir -p "$HOME/.local/share/nvim/undodir"

echo "Creating post-pull hook"
mkdir -p "$HOME/.config/yadm/hooks"
ln -s "$HOME/.local/bin/update_dotfiles" "$HOME/.config/yadm/hooks/post_pull"
chmod +x "$HOME/.config/yadm/hooks/post_pull"